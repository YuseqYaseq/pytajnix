{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="jumbotron">
  <h1 class="display-4">HOME</h1>
  <p class="lead">This is a simple home panel</p>
  <hr class="my-4">
  <p>Pytajnix is future of humanity</p>
  <p class="lead">
    <a class="btn btn-primary btn-lg" href="#" role="button">click!</a>
  </p>
</div>

<div class="album pt-3 py-3">
    {% if error %}
    <div class="alert alert-danger" role="alert">
        {{ error }}
    </div>
    {% endif %}

    {% for q in questions %}
    <div class="card mb-3 shadow-sm" style="cursor: pointer;">
      <div class="card-body">
        <div class="row">
          <div class="col-md-2">
          </div>
          <div class="col-md-5">
            <p class="card-text">{{ q.text }}</p>
            <p class="card-text">{{ q.tags }}</p>
          </div>
          <div class="col-md-5">
            <p class="card-text text-muted">{{a.get_skill_level_display}}</p>

              <a href='/application'>
              <button class="btn btn-dark btn-lg btn-block">
                 VOTE
              </button>
              </a>

          </div>
        </div>
      </div>
    </div>
    {% endfor %}

<table id="questions" style="width:67%; float: left;">
    <tr>
        <th>Question</th>
        <th>Tags</th>
    </tr>
    {%  for question in questions %}
        <tr>
            <th>{{ question.text }}</th>
            <th>{{ question.tags }}</th>
        </tr>
    {% endfor %}
</table>
{% if allow_direct_questions %}
    <table id="direct-messages" style="width:33%">
        <tr>
            <th>Title</th>
            <th>Text</th>
        </tr>
        {% for direct_message in direct_messages %}
            <tr>
                <th>{{ direct_message }}</th>
            </tr>
        {% endfor %}
    </table>
{% endif %}
<input id="question-input" type="text" size="50"/><br/>
<input id="question-tags-input" type="text" size="50"/><br/>
<input id="question-submit" type="button" value="Send"/>
<input id="message-submit" type="button" value="Send private"/>
<script>
    var lecture_id = {{ lecture_id }};

    var chatSocket = new WebSocket(
        'ws://' + window.location.host +
        '/ws/application/lecturer/' + lecture_id + '/');

    chatSocket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        if(data['type'] === 'question_msg') {
            var question = data['question'];
            var tags = data['tags'];
            console.log(data);
            document.querySelector('#questions').innerHTML +=
                "<tr><th>" + question + "</th><th>" + tags + "</th></tr>";
        } else {
            var title = data['title'];
            var text = data['text'];
            console.log(data);
            document.querySelector('#direct-messages').innerHTML +=
                "<tr><th>" + title + "</th><th>" + text + "</th></tr>";
        }

    };

    chatSocket.onclose = function(e) {
        console.error('Socket closed unexpectedly');
    };

    document.querySelector('#question-input').focus();
    document.querySelector('#question-input').onkeyup = function(e) {
        if (e.keyCode === 13) {  // enter, return
            document.querySelector('#question-submit').click();
        }
    };

    document.querySelector('#question-submit').onclick = function(e) {
        var questionInputDom = document.querySelector('#question-input');
        var tagsInputDom = document.querySelector('#question-tags-input');
        var question = questionInputDom.value;
        var tags = tagsInputDom.value;
        chatSocket.send(JSON.stringify({
            'type': 'question_msg',
            'question': question,
            'tags': tags
        }));

        questionInputDom.value = '';
        tagsInputDom.value = '';
    };

    document.querySelector('#message-submit').onclick = function(e) {
        var questionInputDom = document.querySelector('#question-input');
        var tagsInputDom = document.querySelector('#question-tags-input');
        var title = questionInputDom.value;
        var text = tagsInputDom.value;
        chatSocket.send(JSON.stringify({
            'type': 'direct_msg',
            'title': title,
            'text': text
        }));

        questionInputDom.value = '';
        tagsInputDom.value = '';
    };
</script>


</div>

{% endblock %}
</html>