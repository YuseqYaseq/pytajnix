{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="album pt-3 py-3">
    {% if error %}
    <div class="alert alert-danger" role="alert">
        {{ error }}
    </div>
    {% endif %}

    <div class="jumbotron jumbotron-fluid">
        <div class="container">
          <h1 style="text-align:center;">MODERATOR PANEL</h1>
            <h2 style="text-align:center;">{{ moderator_name }}</h2>
          <p class="lead" style="text-align:center;">Lectures to moderate</p>
        </div>
    </div>
    <h2>PUBLIC QUESTIONS</h2>
    <table id="questions" class="table table-sm">
        <tr>
            <th>Question</th>
            <th>Tags</th>
            <th>Action</th>
        </tr>
        {%  for question in questions %}
            <tr>
                <td>{{ question.text }}</td>
                <td>{{ question.tags }}</td>
                <td>
                    <button class="btn btn-success">APPROVE</button>
                </td>
            </tr>
        {% endfor %}
    </table>
</div>

<script>
    var lecture_id = '{{ lecture_id }}';

    var chatSocket = new WebSocket(
        'ws://' + window.location.host +
        '/ws/application/moderator/' + lecture_id + '/');

    chatSocket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        if(data['type'] === 'msg_question') {
            var question = data['question'];
            var tags = data['tags'];
            console.log(data);
            document.querySelector('#questions').innerHTML +=
                "<tr><th>" + question + "</th><th>" + tags + "</th></tr>";
        } else if(data['type'] === 'msg_vote') {
            var value = data['value'];
            var question_id = data['question_id'];
            console.log("msg vote")
        } else if(data['type'] === 'msg_edit') {

            console.log("msg edit");
        } else if(data['type'] === 'msg_delete') {
            var question_id = data['question_id'];
            console.log("msg delete");
        } else if(data['type'] === 'msg_approve') {
            var question_id = data['question_id'];
            console.log("msg approve");
        } else {
            console.warn("Unknown message received: " + data['type']);
        }

    };

    chatSocket.onclose = function(e) {
        console.error('Socket closed unexpectedly');
    };

</script>

{% endblock %}